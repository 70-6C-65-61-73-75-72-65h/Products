{"version":3,"sources":["components/Catalog/AddProduct.jsx"],"names":["AddProductReduxForm","reduxForm","form","validate","props","handleSubmit","pristine","reset","submitting","error","currentDate","Date","minDate","getYear","getMonth","getDate","onSubmit","className","styles","wholeForm","productStyles","fieldDescr","createField","TextArea","requiredField","acceptableName","maxLength200","Input","acceptablePrice","acceptableDiscount","acceptableDiscountEndDate","type","min","value","ImageField","imageFormat","imageWidth_200_4000","imageHeight_200_4000","mimeType","maxWidth","minHeight","minWidth","maxHeight","alt","formSummaryError","disabled","onClick","compose","withAuthRedirect","connect","state","isFetching","products","addProduct","loadImage","useState","added","setAdded","refAdded","useRef","colorAdded","showAddingText","currentCA","setCCA","useEffect","last","current","formData","a","discountEndTime","parse","console","log","productOperationContainer","productOperationHeader","productAdded","style","color"],"mappings":"yQA0GMA,EAAsBC,YAAU,CACpCC,KAAM,aACNC,cAF0BF,EA5EL,SAACG,GAAW,IAE/BC,EAMED,EANFC,aACAC,EAKEF,EALFE,SACAC,EAIEH,EAJFG,MACAC,EAGEJ,EAHFI,WACAC,EAEEL,EAFFK,MAIIC,EAAc,IAAIC,KAClBC,EAAO,UAAMF,EAAYG,UAAY,KAA9B,YACXH,EAAYI,WAAa,EAAI,GACzB,IAAMJ,EAAYI,WAAa,EAC/BJ,EAAYI,WAAa,EAHlB,YAKXJ,EAAYK,UAAY,GACpB,IAAML,EAAYK,UAClBL,EAAYK,WAGlB,OACE,uBAAMC,SAAUX,EAAcY,UAAWC,IAAOC,UAAhD,UACE,qBAAKF,UAAWG,IAAcC,WAA9B,sFACCC,YAAY,gHAAuB,OAAQC,IAAU,CACpDC,IACAC,MAEF,qBAAKR,UAAWG,IAAcC,WAA9B,mGACCC,YAAY,wFAAmB,cAAeC,IAAU,CAACG,MAC1D,qBAAKT,UAAWG,IAAcC,WAA9B,2EACCC,YAAY,gEAAe,QAASK,IAAO,CAC1CH,IACAI,MAEF,qBAAKX,UAAWG,IAAcC,WAA9B,kDACCC,YAAY,uCAAU,WAAYK,IAAO,CAACE,MAC3C,qBAAKZ,UAAWG,IAAcC,WAA9B,kIACCC,YACC,iHACA,kBACAK,IACA,CAACG,KACD,CAAEC,KAAM,OAAQC,IAAKpB,EAASqB,MAAOrB,IAGtCU,YACC,sFACA,QACAY,IACA,CAACV,IAAeW,IAAaC,IAAqBC,KAClD,CACEC,SAAU,wBACVC,SAAU,IACVC,UAAW,IACXC,SAAU,IACVC,UAAW,IACXC,IAAK,kEAIRlC,GAAS,qBAAKQ,UAAWC,IAAO0B,iBAAvB,SAA0CnC,IACpD,qBAAKQ,UAAU,GAAf,SACE,wBAAQc,KAAK,SAASc,SAAUvC,GAAYE,EAA5C,0DAIF,qBAAKS,UAAU,GAAf,SACE,wBAAQc,KAAK,SAASc,SAAUvC,GAAYE,EAAYsC,QAASvC,EAAjE,uHA0EOwC,sBACbC,IACAC,aANsB,SAACC,GAAD,MAAY,CAClCC,WAAYD,EAAME,SAASD,cAKF,CAAEE,eAAYC,gBAF1BP,EA7DI,SAAC,GAA8B,IAAD,IAA3BI,EAA2B,EAA3BA,WAAe/C,EAAY,gCACrBmD,oBAAS,GADY,mBACxCC,EADwC,KACjCC,EADiC,KAEzCC,EAAWC,mBAEXC,GAAU,oBACb,EAAO,OADM,eAEb,EAAQ,QAFK,GAIVC,GAAc,oBACjB,EAAO,mHADU,eAEjB,EAAQ,8IAFS,GAR2B,EAYnBN,oBAAS,GAZU,mBAYxCO,EAZwC,KAY7BC,EAZ6B,KAc/CC,qBAAU,WACHR,EAMHO,GAAO,SAACE,GAAD,OAAWA,KALdP,EAASQ,UACXT,GAAS,GACTM,GAAO,SAACE,GAAD,OAAWA,QAQrB,CAACT,EAAOC,EAAUN,IAErB,IAAMnC,EAAQ,uCAAG,WAAOmD,GAAP,SAAAC,EAAA,6DACXD,EAASE,kBACXF,EAASE,gBAAkB1D,KAAK2D,MAAMH,EAASE,kBAFlC,SAKTjE,EAAMiD,WAAN,eACDc,IANU,OAQfT,EAASQ,SAAU,EACnBK,QAAQC,IAAI,oBACZD,QAAQC,IAAId,EAASQ,SAVN,2CAAH,sDAad,OACE,mCACE,sBAAKjD,UAAWG,IAAcqD,0BAA9B,UACE,oBAAIxD,UAAWG,IAAcsD,uBAA7B,2EACA,qBACEzD,UAAWG,IAAcuD,aACzBC,MAAOpB,EAAQ,CAAEqB,MAAOjB,EAAWE,IAAe,GAFpD,SAIGN,GAASK,EAAeC,KAE3B,cAAC9D,EAAD,CAAqBgB,SAAUA","file":"static/js/3.f9a5c563.chunk.js","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { reduxForm } from \"redux-form\";\r\nimport {\r\n  Input,\r\n  createField,\r\n  ImageField,\r\n  TextArea,\r\n} from \"../FormsControls/FormsControls\";\r\nimport {\r\n  requiredField,\r\n  acceptableName,\r\n  maxLength200,\r\n  acceptablePrice,\r\n  acceptableDiscount,\r\n  acceptableDiscountEndDate,\r\n  validate,\r\n  imageFormat,\r\n  imageHeight_200_4000,\r\n  imageWidth_200_4000,\r\n} from \"../FormsControls/validators\";\r\nimport { connect } from \"react-redux\";\r\nimport { addProduct, loadImage } from \"../../redux/product-reducer\";\r\nimport styles from \"../FormsControls/FormsControls.module.scss\";\r\nimport withAuthRedirect from \"../HOCS/withAuthRedirect\";\r\nimport { compose } from \"redux\";\r\n\r\nimport productStyles from \"./Product.module.scss\";\r\n\r\n// can show the summary error\r\n// form-level validation\r\nconst addProductForm = (props) => {\r\n  const {\r\n    handleSubmit,\r\n    pristine,\r\n    reset,\r\n    submitting,\r\n    error,\r\n    // productLink,\r\n  } = props;\r\n\r\n  const currentDate = new Date();\r\n  const minDate = `${currentDate.getYear() + 1900}-${\r\n    currentDate.getMonth() + 1 < 10\r\n      ? \"0\" + currentDate.getMonth() + 1\r\n      : currentDate.getMonth() + 1\r\n  }-${\r\n    currentDate.getDate() < 10\r\n      ? \"0\" + currentDate.getDate()\r\n      : currentDate.getDate()\r\n  }`;\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className={styles.wholeForm}>\r\n      <div className={productStyles.fieldDescr}>Наименование</div>\r\n      {createField(\"Наименование товара\", \"name\", TextArea, [\r\n        requiredField,\r\n        acceptableName,\r\n      ])}\r\n      <div className={productStyles.fieldDescr}>Описание товара</div>\r\n      {createField(\"Описание товара\", \"description\", TextArea, [maxLength200])}\r\n      <div className={productStyles.fieldDescr}>Цена товара</div>\r\n      {createField(\"Цена товара\", \"price\", Input, [\r\n        requiredField,\r\n        acceptablePrice,\r\n      ])}\r\n      <div className={productStyles.fieldDescr}>Скидка</div>\r\n      {createField(\"Скидка\", \"discount\", Input, [acceptableDiscount])}\r\n      <div className={productStyles.fieldDescr}>Дата окончания скидки</div>\r\n      {createField(\r\n        \"Дата окончания акции\",\r\n        \"discountEndTime\",\r\n        Input,\r\n        [acceptableDiscountEndDate],\r\n        { type: \"date\", min: minDate, value: minDate }\r\n      )}\r\n\r\n      {createField(\r\n        \"Загрузите фото ...\",\r\n        \"photo\",\r\n        ImageField,\r\n        [requiredField, imageFormat, imageWidth_200_4000, imageHeight_200_4000],\r\n        {\r\n          mimeType: \"image/jpeg, image/png\",\r\n          maxWidth: 4000,\r\n          minHeight: 200,\r\n          minWidth: 200,\r\n          maxHeight: 4000,\r\n          alt: \"Фото товара\",\r\n        }\r\n      )}\r\n\r\n      {error && <div className={styles.formSummaryError}>{error}</div>}\r\n      <div className=\"\">\r\n        <button type=\"submit\" disabled={pristine || submitting}>\r\n          Создать\r\n        </button>\r\n      </div>\r\n      <div className=\"\">\r\n        <button type=\"button\" disabled={pristine || submitting} onClick={reset}>\r\n          Очистить значения\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nconst AddProductReduxForm = reduxForm({\r\n  form: \"addProduct\",\r\n  validate,\r\n})(addProductForm);\r\n\r\nconst AddProduct = ({ isFetching, ...props }) => {\r\n  const [added, setAdded] = useState(false);\r\n  const refAdded = useRef();\r\n\r\n  const colorAdded = {\r\n    [true]: \"red\",\r\n    [false]: \"blue\",\r\n  };\r\n  const showAddingText = {\r\n    [true]: \"Товар успешно создан!\",\r\n    [false]: \"Товар в процессе создания...\",\r\n  };\r\n  const [currentCA, setCCA] = useState(true); // change color while create products\r\n\r\n  useEffect(() => {\r\n    if (!added) {\r\n      if (refAdded.current) {\r\n        setAdded(true);\r\n        setCCA((last) => !last); // change color key\r\n      }\r\n    } else {\r\n      setCCA((last) => !last);\r\n    }\r\n    // if product fetching changed -> addProduct method started or ended ->\r\n    // should run effect to check addProduct state -> if addProduct ended ->\r\n    // product added -> else -> submit denied because of request denied\r\n  }, [added, setAdded, isFetching]);\r\n\r\n  const onSubmit = async (formData) => {\r\n    if (formData.discountEndTime) {\r\n      formData.discountEndTime = Date.parse(formData.discountEndTime);\r\n    }\r\n\r\n    await props.addProduct({\r\n      ...formData,\r\n    });\r\n    refAdded.current = true;\r\n    console.log(\"refAdded.current\");\r\n    console.log(refAdded.current);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className={productStyles.productOperationContainer}>\r\n        <h1 className={productStyles.productOperationHeader}>Новый товар</h1>\r\n        <div\r\n          className={productStyles.productAdded}\r\n          style={added ? { color: colorAdded[currentCA] } : {}}\r\n        >\r\n          {added && showAddingText[currentCA]}\r\n        </div>\r\n        <AddProductReduxForm onSubmit={onSubmit} />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  isFetching: state.products.isFetching,\r\n});\r\n\r\nexport default compose(\r\n  withAuthRedirect,\r\n  connect(mapStateToProps, { addProduct, loadImage })\r\n)(AddProduct);\r\n"],"sourceRoot":""}